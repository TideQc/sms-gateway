â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   SMS GATEWAY FRONTEND - ARCHITECTURE                       â•‘
â•‘                         APRÃˆS CONSOLIDATION                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ STRUCTURE DES FICHIERS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

index.html (52 lignes)
â”œâ”€ <div id="app"></div>  (point d'entrÃ©e unique)
â””â”€ Imports JS (dans cet ordre):

    1. LIBRARIES (externes)
    â”œâ”€ socket.io.min.js
    â”œâ”€ jquery.min.js
    â”œâ”€ bootstrap.min.js
    â”œâ”€ dataTables.min.js
    â””â”€ dataTables.bootstrap5.js

    2. CONFIGURATION & UTILITIES (dÃ©pendances de base)
    â”œâ”€ config.js (0.71 KB)
    â”‚  â””â”€ const CONFIG = { API_URL, STORAGE_KEYS, TIMEOUTS, COLORS, ... }
    â”œâ”€ utils.js (2.45 KB)
    â”‚  â””â”€ formatDateEST(), escapeHtml(), normalizePhone(), debounce(), ...
    â””â”€ notifications.js (3.02 KB)
       â””â”€ NotificationManager class + notificationManager instance

    3. APPLICATION CORE
    â”œâ”€ main.js (24.3 KB)
    â”‚  â””â”€ class cpaSmsApp {
    â”‚     â”œâ”€ constructor(containerId)
    â”‚     â”œâ”€ init()
    â”‚     â”œâ”€ _initApi()      â†’ this.api = { call(), login(), getParticipants(), ... }
    â”‚     â”œâ”€ _initUI()       â†’ this.ui = { renderLogin(), renderApp(), ... }
    â”‚     â”œâ”€ _initLogin()    â†’ this.login = { handleSubmit() }
    â”‚     â”œâ”€ _initSMS()      â†’ this.sms = { loadReceived(), loadArchive() } (stubs)
    â”‚     â”œâ”€ _initParticipants() â†’ this.participants = { load() } (stub)
    â”‚     â”œâ”€ _verifyToken()
    â”‚     â”œâ”€ _showLogin() / _showMainApp()
    â”‚     â”œâ”€ _initializeApp()
    â”‚     â”œâ”€ _setupBurgerMenu()
    â”‚     â”œâ”€ _checkPixelStatus()
    â”‚     â”œâ”€ _initializeWebSocket()
    â”‚     â””â”€ _logout()
    â”‚
    â”œâ”€ sms-module.js (15.57 KB)
    â”‚  â””â”€ Object.assign(cpaSmsApp.prototype, {
    â”‚     â”œâ”€ loadReceivedSMS()     â†’ Charger SMS reÃ§us depuis API
    â”‚     â”œâ”€ loadArchive()         â†’ Charger archive complÃ¨te
    â”‚     â”œâ”€ _renderArchive()      â†’ Rendu HTML archive (groupÃ© par contact)
    â”‚     â”œâ”€ _toggleArchiveMessages() â†’ Afficher/masquer conversation
    â”‚     â”œâ”€ _toggleEmojiPicker()  â†’ Picker emojis
    â”‚     â”œâ”€ _addEmoji()           â†’ Ajouter emoji au texte
    â”‚     â””â”€ _sendQuickReply()     â†’ Envoyer rÃ©ponse (WebSocket)
    â”‚
    â””â”€ participants-module.js (8.78 KB)
       â””â”€ Object.assign(cpaSmsApp.prototype, {
          â”œâ”€ loadParticipants()   â†’ Charger depuis API et init DataTable
          â”œâ”€ _updateParticipantsTags() â†’ Mettre Ã  jour tags sÃ©lection
          â”œâ”€ _removeParticipantTag() â†’ Retirer tag sÃ©lection
          â”œâ”€ _generateFilters()   â†’ CrÃ©er filtres (Parc, Type, Coach)
          â””â”€ _setupCheckboxHandlers() â†’ Event listeners checkboxes

    4. INITIALISATION (point d'entrÃ©e)
    â””â”€ app.js (0.19 KB)
       â””â”€ const app = new cpaSmsApp('#app');
          app.init();


ğŸ”„ FLUX D'EXÃ‰CUTION AU DÃ‰MARRAGE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Chargement HTML
   â†“
2. ExÃ©cution des scripts dans l'ordre:
   - Libraries chargÃ©es (jQuery, Bootstrap, DataTables, Socket.io)
   - CONFIG object crÃ©Ã© et disponible globalement
   - Fonctions utilitaires disponibles (formatDateEST, escapeHtml, etc.)
   - NotificationManager initialisÃ©
   - Classe cpaSmsApp dÃ©finie
   - Extensions SMS et Participants ajoutÃ©es Ã  cpaSmsApp.prototype
   â†“
3. app.js exÃ©cutÃ©:
   const app = new cpaSmsApp('#app');
   app.init();
   â†“
4. Dans cpaSmsApp.init():
   â”œâ”€ Initialiser modules (_initApi, _initUI, _initLogin, _initSMS, _initParticipants)
   â”œâ”€ VÃ©rifier si token existe
   â””â”€ Si token valide â†’ _verifyToken() â†’ _showMainApp() â†’ _initializeApp()
      Sinon â†’ _showLogin()
   â†“
5. Dans _initializeApp():
   â”œâ”€ _checkPixelStatus()
   â”œâ”€ loadParticipants() â†’ charge et affiche DataTable
   â”œâ”€ loadReceivedSMS() â†’ affiche SMS reÃ§us
   â”œâ”€ loadArchive() â†’ charge et affiche archive groupÃ©e
   â””â”€ _initializeWebSocket() â†’ Ã©coute events en temps rÃ©el


ğŸ’¬ APPELS API
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Tous les appels API passent par this.api.call(endpoint, options):
â”œâ”€ /login
â”œâ”€ /verify-token
â”œâ”€ /participants
â”œâ”€ /unread-sms
â”œâ”€ /sent-messages-archive
â”œâ”€ /send-bulk
â”œâ”€ /mark-sms-read/:id
â”œâ”€ /mark-conversation-read
â”œâ”€ /pixel-status
â”œâ”€ /pixel/sync-unread-only
â””â”€ /pixel/sync-sms

Tous inclus automatiquement dans Authorization header: Bearer TOKEN


ğŸ¨ Ã‰TAT GLOBAL (cpaSmsApp.state)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{
  user: string,                              // Nom utilisateur connectÃ©
  authToken: string,                         // JWT token
  isLoggedIn: boolean,                       // Ã‰tat connexion
  selectedParticipants: {id: {name, phone}}, // SÃ©lection pour envoi SMS
  allParticipants: [],                       // Cache participants
  smsQuickReplyCallbacks: {callbackId: fn},  // Callbacks rÃ©ponses rapides
  dataTable: DataTable,                      // Instance DataTable
  socket: Socket,                            // Connection Socket.io
  filters: {parc, type, coach},              // Filtres actifs
  openConversation: string                   // Conversation ouverte
}


ğŸ“¡ WEBSOCKET EVENTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ReÃ§us:
â”œâ”€ 'progress' â†’ Mise Ã  jour barre progression envoi SMS
â”œâ”€ 'finish' â†’ Envoi SMS terminÃ©
â”œâ”€ 'sms-sent' â†’ RÃ©ponse rapide envoyÃ©e (via callback)
â””â”€ 'new-sms' â†’ Nouveau SMS reÃ§u

EnvoyÃ©s:
â””â”€ 'send-sms-quick' â†’ Envoyer rÃ©ponse rapide


ğŸ¯ DOMAINES DE RESPONSABILITÃ‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

config.js
â””â”€ Source unique pour CONFIG (API_URL, COLORS, TIMEOUTS)

utils.js
â””â”€ Fonctions utilitaires (formatage, Ã©chappement, normalisation)

notifications.js
â””â”€ SystÃ¨me notifications (toast messages)

main.js (cpaSmsApp class)
â”œâ”€ Authentification (login, token, logout)
â”œâ”€ Orchestration (init, _initializeApp)
â”œâ”€ UI rendering (renderLogin, renderApp)
â”œâ”€ API wrapper (tous les endpoints)
â”œâ”€ WebSocket setup
â””â”€ Menu/Status UI

sms-module.js (extensions cpaSmsApp)
â”œâ”€ Charger SMS reÃ§us
â”œâ”€ Afficher/gÃ©rer archive
â”œâ”€ Emojis picker
â””â”€ Envoyer rÃ©ponses rapides

participants-module.js (extensions cpaSmsApp)
â”œâ”€ Charger participants
â”œâ”€ Initialiser DataTable
â”œâ”€ GÃ©rer sÃ©lection (checkboxes)
â””â”€ GÃ©rer filtres


âœ… VALIDATIONS EFFECTUÃ‰ES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[x] Aucun code dupliquÃ© entre fichiers
[x] DÃ©pendances claires et hiÃ©rarchisÃ©es
[x] Pas de hardcoded URLs (CONFIG.API_URL)
[x] Syntaxe JavaScript validÃ©e
[x] Ordre des imports critique respectÃ©
[x] Module SMS complÃ¨tement implÃ©mentÃ©
[x] Module participants complÃ¨tement implÃ©mentÃ©
[x] Notifications systÃ¨me en place
[x] Gestion d'erreurs
[x] CSS organisÃ©es par domaine (16 fichiers)
[x] Backup main.js.bak crÃ©Ã©


ğŸš€ POUR DÃ‰MARRER LE FRONTEND
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Assurez-vous que le backend est accessible Ã  CONFIG.API_URL
2. Ouvrez index.html dans un navigateur
3. Loggez-vous avec vos credentials
4. Le systÃ¨me charger automatiquement:
   - Liste des participants (DataTable)
   - SMS reÃ§us
   - Archive des conversations
5. Les WebSockets se connecteront automatiquement


âš ï¸ NOTES IMPORTANTES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

- CONFIG est un object global (pas de import/export, compatible navigateur)
- NotificationManager est une instance globale (notificationManager)
- cpaSmsApp est une classe globale
- Tous les modules partagent le mÃªme this (mÃªme instance)
- Les extensions SMS et participants utilisent Object.assign pour ajouter des methods
- Les fonctions utils (formatDateEST, escapeHtml, etc.) sont globales
- jQuery est utilisÃ© pour DOM queries lÃ©gÃ¨res
- DataTables est initialiÃ© avec configuration optimale (scrolling, pagination)
